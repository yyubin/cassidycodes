ì´ ê¸€ì€ ì§ì ‘ ë§Œë“  Sprout í”„ë ˆì„ì›Œí¬ì— ë‚´ì¥ëœ HTTP ì„œë²„ê°€ Java NIO(New I/O)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì–´ë–»ê²Œ Non-Blocking I/Oë¥¼ êµ¬í˜„í•˜ê³ , ë‹¤ìˆ˜ì˜ ë™ì‹œ ì—°ê²°ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ì— ëŒ€í•´ ìƒì„¸íˆ ì„¤ëª…í•´ ë³¼ ì˜ˆì •ì´ë‹¤. íŠ¹íˆ `Selector`ë¥¼ í™œìš©í•œ ì´ë²¤íŠ¸ ë£¨í”„ ëª¨ë¸ê³¼ HTTP ìš”ì²­ ì²˜ë¦¬ íë¦„ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„œìˆ í•´ ë³´ë ¤ê³  í•œë‹¤.

> ì–´ë””ê¹Œì§€ë‚˜ í•´ë‹¹ í”„ë¡œì íŠ¸ëŠ” **ê°œì¸ì˜ í•™ìŠµ**ì— ëª©ì ì´ ìˆìŠµë‹ˆë‹¤.   
> ì¶”ê°€ì ì¸ ê°œì„  ì‚¬í•­ ë° í™•ì¥, ê±´ì˜ëŠ” ì–¸ì œë‚˜ í™˜ì˜ ğŸ˜†


---
# ğŸ’¡ ì§„ì§œ ê°„ë‹¨í•œ ìš”ì•½
- **I/O ìŠ¤ë ˆë“œ** = ì´ë²¤íŠ¸ ê°ì‹œì (Selector ë£¨í”„ì—ì„œ OP_ACCEPT, OP_READ, OP_WRITE ê´€ì°°)
- **ì›Œì»¤ ìŠ¤ë ˆë“œ** = ìš”ì²­ ì²˜ë¦¬ì (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰, ì‘ë‹µ ìƒì„±)

SproutëŠ” I/O ìŠ¤ë ˆë“œëŠ” í•œ ê°œë§Œ ì‚¬ìš©í•˜ê³ ,  
ìš”ì²­ ì²˜ë¦¬ëŠ” ì›Œì»¤ ìŠ¤ë ˆë“œë¡œ ë¶„ë¦¬ë¨ (ê°€ìƒ ìŠ¤ë ˆë“œ or í”Œë«í¼ ìŠ¤ë ˆë“œ ì„ íƒ ê°€ëŠ¥)

- HTTPëŠ” ì›Œì»¤ ìŠ¤ë ˆë“œë¥¼ í†µí•´ ì²˜ë¦¬ë˜ë©°, **ë¸”ë¡œí‚¹ / ë…¼ë¸”ë¡œí‚¹** ë°©ì‹ ì„ íƒ ê°€ëŠ¥  
- WebSocketì€ í•­ìƒ **ë…¼ë¸”ë¡œí‚¹ (NIO)** ìœ¼ë¡œ ê³ ì • ì²˜ë¦¬ë¨

---

## 1. Non-Blocking I/Oì™€ ì´ë²¤íŠ¸ ë£¨í”„ì˜ í•„ìš”ì„±

ì „í†µì ì¸ Blocking I/O ëª¨ë¸ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ë§ˆë‹¤ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¥¼ í• ë‹¹í•œë‹¤. ì´ ë°©ì‹ì€ êµ¬í˜„ì´ ê°„ë‹¨í•˜ì§€ë§Œ, ìˆ˜ì²œ, ìˆ˜ë§Œ ê°œì˜ ë™ì‹œ ì—°ê²°ì´ ë°œìƒí•˜ë©´ ìŠ¤ë ˆë“œ ìƒì„± ë° ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ë¹„ìš©ì´ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•˜ì—¬ ì„œë²„ì˜ ì„±ëŠ¥ ì €í•˜ë¥¼ ìœ ë°œí•˜ê¸°ë„ í•œë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ìƒìš© ì„œë²„ í”„ë ˆì„ì›Œí¬ë“¤ì€ ì£¼ë¡œ Java NIOì˜ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•œ **ì´ë²¤íŠ¸ ê¸°ë°˜ Non-Blocking I/O ëª¨ë¸**ì„ ì±„íƒí•œë‹¤. ì´ ëª¨ë¸ì€ ë‹¨ì¼ ìŠ¤ë ˆë“œ(ë˜ëŠ” ì†Œìˆ˜ì˜ ìŠ¤ë ˆë“œ)ê°€ `Selector`ë¥¼ í†µí•´ ë‹¤ìˆ˜ì˜ `Channel`(ì—°ê²°)ì—ì„œ ë°œìƒí•˜ëŠ” I/O ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³  ì²˜ë¦¬í•œë‹¤. ì´ë¥¼ í†µí•´ ìŠ¤ë ˆë“œ ìì›ì„ ë§¤ìš° íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë©° ë†’ì€ ë™ì‹œì„±(Concurrency)ì„ ë‹¬ì„±í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

ë‚˜ ë˜í•œ ì´ëŸ¬í•œ êµ¬ì¡°ë¥¼ ê¹Šì´ ìˆê²Œ ì•Œê¸° ìœ„í•´ ì´ëŸ¬í•œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ë‹¤.

- **`ServerSocketChannel`**: ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²° ìš”ì²­ì„ ìˆ˜ì‹ í•˜ëŠ” ì±„ë„ì´ë‹¤. Non-blocking ëª¨ë“œë¡œ ì„¤ì •ëœë‹¤.
- **`SocketChannel`**: ê° í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ë°ì´í„° í†µì‹ ì„ ìœ„í•œ ì±„ë„ì´ë‹¤. ì—­ì‹œ Non-blocking ëª¨ë“œë¡œ ì‘ë™.
- **`Selector`**: ì—¬ëŸ¬ `Channel`ì„ ë“±ë¡í•˜ê³ , ê·¸ì¤‘ I/O ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì±„ë„ì„ ì•Œë ¤ì£¼ëŠ” ì—­í• ì„ í•œë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ì˜ ì‹¬ì¥ê³¼ë„ ê°™ë‹¤. ë‹¨ìˆœí•˜ê²Œ, I/O ìŠ¤ë ˆë“œë¼ê³  ìƒê°í•´ë„ ëœë‹¤.
- **`SelectionKey`**: `Selector`ê°€ íŠ¹ì • `Channel`ì˜ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•  ë•Œ ì‚¬ìš©í•˜ëŠ” í‚¤ì´ë‹¤. ì´ë²¤íŠ¸ì˜ ì¢…ë¥˜(`ACCEPT`, `READ`, `WRITE`)ì™€ ìƒíƒœë¥¼ ë‹´ê³  ìˆë‹¤.

## 2. ì„œë²„ì˜ í•µì‹¬ ì•„í‚¤í…ì²˜ ì»´í¬ë„ŒíŠ¸

Sproutì—ì„œ êµ¬í˜„í•  ë•Œ Non-Blocking ì„œë²„ëŠ” ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì˜ ìœ ê¸°ì ì¸ ìƒí˜¸ì‘ìš©ìœ¼ë¡œ êµ¬ì„±í•˜ì˜€ë‹¤.

- **`NioHybridServerStrategy`**: `Selector`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì¸ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì‹¤í–‰í•˜ëŠ” í•µì‹¬ ì „ëµ í´ë˜ìŠ¤ì´ë‹¤. ì„œë²„ì˜ ì‹¬ì¥ë¶€ ì—­í• . ì‚¬ì‹¤ ì „ëµ ì¤‘ í•˜ë‚˜ë¼ ì´ ë¶€ë¶„ë„ í™•ì¥ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, í˜„ì¬ëŠ” ëª¨ë“  ëª¨ë“œì—ì„œ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì„œ ì¶”ê°€ì ì¸ ë‹¤ë¥¸ êµ¬í˜„ì²´ëŠ” ì—†ë‹¤.
- **`ConnectionManager`**: ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ì„ ìˆ˜ë½í•˜ê³ , í•´ë‹¹ ì—°ê²°ì´ ì–´ë–¤ í”„ë¡œí† ì½œ(HTTP, WebSocket ë“±)ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ê°ì§€í•˜ì—¬ ì ì ˆí•œ í•¸ë“¤ëŸ¬ì—ê²Œ ì „ë‹¬í•œë‹¤.
- **`ProtocolDetector`**: ì±„ë„ì—ì„œ ì½ì€ ì´ˆê¸° ë°”ì´íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ í”„ë¡œí† ì½œì„ ì‹ë³„í•œë‹¤. (`HttpProtocolDetector`ê°€ ëŒ€í‘œì ì…ë‹ˆë‹¤.)
- **`ProtocolHandler`**: íŠ¹ì • í”„ë¡œí† ì½œì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬. Sproutì€ `NioHttpProtocolHandler` (Pure NIO)ì™€ `BioHttpProtocolHandler` (Hybrid) ë‘ ê°€ì§€ HTTP ì²˜ë¦¬ ë°©ì‹ì„ ì œê³µí•œë‹¤. ì´ ë¬¸ì„œì—ì„œëŠ” `NioHttpProtocolHandler`ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ëª…í•œë‹¤.
- **`HttpConnectionHandler`**: Pure NIO ëª¨ë“œì—ì„œ ê°œë³„ HTTP ì—°ê²°ì˜ ìƒíƒœ(ì½ê¸°, ì²˜ë¦¬, ì“°ê¸°)ë¥¼ ê´€ë¦¬í•˜ëŠ” ìƒíƒœ ê¸°ë°˜(stateful) í•¸ë“¤ëŸ¬. `SelectionKey`ì— ì²¨ë¶€(attachment)ë˜ì–´ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ í˜¸ì¶œëœë‹¤.
- **`RequestExecutorService`**: I/O ì‘ì—…ê³¼ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬ë¥¼ ë¶„ë¦¬í•˜ê¸° ìœ„í•œ ìŠ¤ë ˆë“œ ì„œë¹„ìŠ¤ì´ë‹¤. ì´ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ê³ , ì´ì— ëŒ€í•œ êµ¬í˜„ì²´ë¡œ ê°ê° ê°€ìƒ ìŠ¤ë ˆë“œ ëª¨ë“œ, í”Œë«í¼ ìŠ¤ë ˆë“œ ëª¨ë“œê°€ ìˆëŠ” ê²ƒì´ë‹¤. I/O ìŠ¤ë ˆë“œê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬ë¡œ ì¸í•´ ë¸”ë¡œí‚¹ë˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.

## 3. í”„ë¡œí† ì½œ ê°ì§€(Protocol Detection)ì™€ ë¼ìš°íŒ…

`Selector`ê°€ ìƒˆë¡œìš´ ì—°ê²°ì„ ìˆ˜ë½í•œ ì§í›„, ì„œë²„ëŠ” ì´ ì—°ê²°ì„ í†µí•´ ì–´ë–¤ í”„ë¡œí† ì½œ(HTTP, WebSocket ë“±)ì˜ ë°ì´í„°ê°€ ì˜¤ê³  ê°ˆì§€ ê²°ì •í•´ì•¼ í•œë‹¤. ì´ ì¤‘ìš”í•œ ì—­í• ì„ `ConnectionManager`ì™€ `ProtocolDetector`ê°€ ë‹´ë‹¹í•œë‹¤.

`DefaultConnectionManager`ëŠ” ë“±ë¡ëœ `ProtocolDetector`ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ì—¬ í”„ë¡œí† ì½œì„ ì‹ë³„í•œë‹¤.

```java
// DefaultConnectionManager.java
@Override
public void acceptConnection(SelectionKey selectionKey, Selector selector)
        throws Exception {
    // ... ì—°ê²° ìˆ˜ë½ ë° ì´ˆê¸° ë°”ì´íŠ¸ ì½ê¸° ...

    // 3. í”„ë¡œí† ì½œ ê°ì§€
    String detectedProtocol = "UNKNOWN";
    for (ProtocolDetector detector : detectors) {
        detectedProtocol = detector.detect(buffer);
        if (!"UNKNOWN".equals(detectedProtocol)) {
            break; // í”„ë¡œí† ì½œì´ ì‹ë³„ë˜ë©´ ì¤‘ë‹¨
        }
    }

    // 4. ì ì ˆí•œ í•¸ë“¤ëŸ¬ë¡œ ë¼ìš°íŒ…
    for (ProtocolHandler handler : handlers) {
        if (handler.supports(detectedProtocol)) {
            // ... í•¸ë“¤ëŸ¬ ì‹¤í–‰ ...
        }
    }
}
```

### WebSocket ê°ì§€ ë° NIO ì²˜ë¦¬ ê°•ì œ

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ ì„œë²„ì˜ ê¸°ë³¸ ë™ì‘ ëª¨ë“œê°€ `hybrid`(BIO)ë¡œ ì„¤ì •ë˜ì–´ ìˆë”ë¼ë„, **WebSocket ì—°ê²°ì€ í•­ìƒ `NIO` ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤ëŠ” ê²ƒ**ì´ë‹¤.

WebSocket í”„ë¡œí† ì½œì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ì—°ê²°ì´ ê³„ì† ìœ ì§€ë˜ëŠ”(stateful) ì–‘ë°©í–¥ í†µì‹ ì„ ì „ì œë¡œ í•œë‹¤. ì´ëŸ¬í•œ íŠ¹ì„± ë•Œë¬¸ì— ì—°ê²°ë§ˆë‹¤ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹ì‹œí‚¤ëŠ” BIO ëª¨ë¸ë³´ë‹¤ëŠ”, ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìˆ˜ì˜ ì—°ê²°ì„ ê´€ë¦¬í•˜ëŠ” NIO ëª¨ë¸ì´ í›¨ì”¬ íš¨ìœ¨ì ì´ê³  ì í•©í•˜ë‹¤. ì‹¤ì œë¡œ í†°ìº£ë„ ì´ì™€ ê°™ì´ êµ¬ì„±ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— í•´ë‹¹ ëª¨ë¸ì„ ë”°ë¥´ë„ë¡ ì„¤ê³„í•˜ì˜€ë‹¤.

ì´ ì ì„ ê³ ë ¤í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ í”„ë¡œí† ì½œì„ ì§€ëŠ¥ì ìœ¼ë¡œ ê°ì§€í•˜ê³  ë¼ìš°íŒ… í•œë‹¤.

1.  **WebSocket ì—…ê·¸ë ˆì´ë“œ ìš”ì²­ ì‹ë³„**: WebSocket ì—°ê²°ì€ í‘œì¤€ HTTP GET ìš”ì²­ìœ¼ë¡œ ì‹œì‘ëœë‹¤. ë‹¤ë§Œ, í—¤ë”ì— `Upgrade: websocket`ê³¼ `Connection: Upgrade` ê°™ì€ íŠ¹ì • ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤.
2.  **`WebSocketProtocolDetector`**: `ProtocolDetector` ì²´ì¸ì—ëŠ” ì¼ë°˜ `HttpProtocolDetector`ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ `WebSocketProtocolDetector`ê°€ ì¡´ì¬í•œë‹¤. ì´ íƒì§€ê¸°ëŠ” ì´ˆê¸° ë°ì´í„°ì—ì„œ ìœ„ì˜ `Upgrade` í—¤ë”ê°€ ìˆëŠ”ì§€ë¥¼ ë¨¼ì € í™•ì¸í•œë‹¤.
3.  **í”„ë¡œí† ì½œ ë¼ìš°íŒ…**: `Upgrade` í—¤ë”ê°€ ë°œê²¬ë˜ë©´, í”„ë¡œí† ì½œì€ `HTTP/1.1`ì´ ì•„ë‹Œ `WEBSOCKET`ìœ¼ë¡œ ì‹ë³„ëœë‹¤.
4.  **NIO í•¸ë“¤ëŸ¬ ë§¤í•‘**: `ConnectionManager`ëŠ” `WEBSOCKET` í”„ë¡œí† ì½œì„ ì§€ì›í•˜ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì°¾ëŠ”ë‹¤. ì´ í•¸ë“¤ëŸ¬ëŠ” ì„œë²„ì˜ ë™ì‘ ëª¨ë“œì™€ ê´€ê³„ì—†ì´ í•­ìƒ Non-blocking I/Oë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ëœ `NioWebSocketProtocolHandler`ì´ë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ, `hybrid` ëª¨ë“œì—ì„œ ì¼ë°˜ì ì¸ HTTP ìš”ì²­ì€ `BioHttpProtocolHandler`ë¡œ ì „ë‹¬ë˜ì–´ BIO ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ë§Œ, WebSocket ì—°ê²° ìš”ì²­ì€ `BioHttpProtocolHandler`ë¥¼ ìš°íšŒí•˜ì—¬ `NioWebSocketProtocolHandler`ë¡œ ì§ì ‘ ì „ë‹¬ëœë‹¤. ì´ë¥¼ í†µí•´ ê° í”„ë¡œí† ì½œì˜ íŠ¹ì„±ì— ê°€ì¥ ì í•©í•œ I/O ëª¨ë¸ë¡œ ì²˜ë¦¬í•˜ëŠ” ìœ ì—°í•˜ê³  íš¨ìœ¨ì ì¸ ì•„í‚¤í…ì²˜ë¥¼ êµ¬í˜„í•˜ê³ ì í•˜ì˜€ë‹¤.

## 4. í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ(Hybrid Mode): NIOì™€ BIOì˜ ê²°í•©

Sproutì€ Pure NIO ëª¨ë“œ ì™¸ì—ë„, NIOì˜ ì¥ì (ì´ë²¤íŠ¸ ê¸°ë°˜ ì—°ê²° ìˆ˜ë½)ê³¼ ì „í†µì ì¸ BIO(Blocking I/O)ì˜ ì¥ì (ë‹¨ìˆœí•œ í”„ë¡œê·¸ë˜ë° ëª¨ë¸)ì„ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œë¥¼ ì§€ì›í•˜ë„ë¡ í•˜ì˜€ë‹¤. ì´ ëª¨ë“œëŠ” íŠ¹íˆ Java 21ì˜ ê°€ìƒ ìŠ¤ë ˆë“œ(Virtual Threads)ì™€ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ ë†’ì€ ì²˜ë¦¬ëŸ‰ê³¼ ê°œë°œ í¸ì˜ì„±ì„ ë™ì‹œì— ì œê³µí•˜ê³ ì í•˜ì˜€ë‹¤.

í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œì˜ í•µì‹¬ ì•„ì´ë””ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
1.  **ì—°ê²° ìˆ˜ë½ì€ Non-blocking NIO**ë¡œ ì²˜ë¦¬í•œë‹¤. (`Selector`ê°€ `OP_ACCEPT` ì²˜ë¦¬)
2.  ì—°ê²°ì´ ìˆ˜ë¦½ë˜ê³  HTTP í”„ë¡œí† ì½œì´ ê°ì§€ë˜ë©´, í•´ë‹¹ `SocketChannel`ì„ **NIO `Selector`ì˜ ê´€ë¦¬ì—ì„œ ë¶„ë¦¬**í•œë‹¤.
3.  ì±„ë„ì„ **Blocking ëª¨ë“œë¡œ ì „í™˜**(`channel.configureBlocking(true)`)í•œë‹¤.
4.  ì´í›„ì˜ ëª¨ë“  I/O(ìš”ì²­ ì½ê¸°, ì‘ë‹µ ì“°ê¸°)ëŠ” **ë³„ë„ì˜ ì›Œì»¤ ìŠ¤ë ˆë“œì—ì„œ Blocking ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬**í•œë‹¤.

### í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œì˜ ì²˜ë¦¬ íë¦„

1.  **1~2ë‹¨ê³„ (ì—°ê²° ìˆ˜ë½ ë° í”„ë¡œí† ì½œ ê°ì§€)** Pure NIO ëª¨ë“œì™€ ë™ì¼í•˜ê²Œ `Selector`ê°€ `OP_ACCEPT` ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ `ConnectionManager`ê°€ ì—°ê²°ì„ ìˆ˜ë½í•˜ê³  í”„ë¡œí† ì½œì„ ê°ì§€.
2.  **í•¸ë“¤ëŸ¬ ì„ íƒ:** ì„œë²„ ì„¤ì •ì´ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œì¼ ê²½ìš°, `ConnectionManager`ëŠ” `BioHttpProtocolHandler`ë¥¼ ì„ íƒí•˜ì—¬ `accept()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œ. ê± ë‚´ë¶€ì ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ë¡œ ì£¼ì…ë°›ëŠ”ë°, ëª¨ë“œë¥¼ ë¯¸ë¦¬ ê°ì§€í•´ì„œ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ì— ë§ëŠ” êµ¬í˜„ì²´ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•´ë‘ .
3.  **`BioHttpProtocolHandler`ì˜ ë™ì‘**
    -   `SocketChannel`ì„ `Selector`ì—ì„œ ë¶„ë¦¬í•œë‹¤.
    -   `channel.configureBlocking(true)`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì±„ë„ì„ ë¸”ë¡œí‚¹ ëª¨ë“œë¡œ ë§Œë“ ë‹¤.
    -   `RequestExecutorService`ë¥¼ í†µí•´ ì›Œì»¤ ìŠ¤ë ˆë“œ(ì£¼ë¡œ ê°€ìƒ ìŠ¤ë ˆë“œ)ì—ê²Œ ì´í›„ì˜ ëª¨ë“  ì²˜ë¦¬ ê³¼ì •ì„ ìœ„ì„í•œë‹¤.
4.  **ì›Œì»¤ ìŠ¤ë ˆë“œì˜ Blocking I/O ì²˜ë¦¬**
    -   ì›Œì»¤ ìŠ¤ë ˆë“œëŠ” `socket.getInputStream()`ê³¼ `socket.getOutputStream()`ì„ ì‚¬ìš©í•˜ì—¬ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ ìš”ì²­ì„ ì „ë¶€ ì½ê³  ì‘ë‹µì„ ì „ë¶€ ë³´ë‚¸ë‹¤
    -   ê° I/O ì‘ì—…ì€ ë°ì´í„°ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ í•´ë‹¹ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹í•˜ì§€ë§Œ, ê°€ìƒ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì´ ë¸”ë¡œí‚¹ ë¹„ìš©ì´ ë§¤ìš° ì €ë ´í•˜ë¯€ë¡œ ì „ì²´ ì„œë²„ì˜ ì„±ëŠ¥ ì €í•˜ ì—†ì´ ìˆ˜ë§ì€ ë™ì‹œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê²ƒì´ë‹¤.

```java
// BioHttpProtocolHandler.java
@Override
public void accept(SocketChannel channel, Selector selector,
                  ByteBuffer initialBuffer) throws Exception {
    // 1. NIO selectorì—ì„œ ë¶„ë¦¬
    detachFromSelector(channel, selector);

    // 2. Blocking ëª¨ë“œë¡œ ì „í™˜
    channel.configureBlocking(true);
    Socket socket = channel.socket();

    // 3. ì›Œì»¤ ìŠ¤ë ˆë“œ(ê°€ìƒ ìŠ¤ë ˆë“œ)ì— ì‘ì—… ìœ„ì„
    requestExecutorService.execute(() -> {
        try (InputStream in = socket.getInputStream();
             BufferedWriter out = new BufferedWriter(
                 new OutputStreamWriter(socket.getOutputStream()))) {

            // 4. ìš”ì²­ì„ ëê¹Œì§€ ì½ìŒ (Blocking)
            String rawRequest = HttpUtils.readRawRequest(initialBuffer, in);

            // 5. íŒŒì‹± ë° ë””ìŠ¤íŒ¨ì¹˜
            HttpRequest<?> req = parser.parse(rawRequest);
            HttpResponse res = new HttpResponse();
            dispatcher.dispatch(req, res);

            // 6. ì‘ë‹µì„ ì”€ (Blocking)
            writeResponse(out, res.getResponseEntity());
        } catch (Exception e) {
            e.printStackTrace();
        }
    });
}
```

ì´ ë°©ì‹ì€ Non-blocking NIOì˜ ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬(state machine) ì—†ì´, ë™ê¸°ì ì´ê³  ìˆœì°¨ì ì¸ ì½”ë“œë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ì£¼ì–´ ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ í¬ê²Œ í–¥ìƒì‹œì¼°ë‹¤.

## 5. HTTP ìš”ì²­ ì²˜ë¦¬ íë¦„ (Pure NIO ëª¨ë“œ)

ì´ì œ í´ë¼ì´ì–¸íŠ¸ê°€ HTTP ìš”ì²­ì„ ë³´ë‚´ê³  ì„œë²„ê°€ ì‘ë‹µì„ ì™„ë£Œí•˜ê¸°ê¹Œì§€ì˜ ì „ì²´ ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ë”°ë¼ê°€ ë³´ì.

### 1ë‹¨ê³„: ì„œë²„ ì‹œì‘ ë° ì—°ê²° ëŒ€ê¸°

1.  `SproutApplication`ì´ ì‹¤í–‰ë˜ë©´ `HttpServer`ê°€ `NioHybridServerStrategy`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¥¼ ì‹œì‘í•œë‹¤.
2.  `NioHybridServerStrategy`ëŠ” `Selector`ì™€ `ServerSocketChannel`ì„ ìƒì„±í•˜ê³ , `ServerSocketChannel`ì„ Non-blocking ëª¨ë“œë¡œ ì„¤ì •í•œë‹¤.
3.  `ServerSocketChannel`ì„ `Selector`ì— `SelectionKey.OP_ACCEPT` ì´ë²¤íŠ¸ë¡œ ë“±ë¡í•œë‹¤. ì´ëŠ” "ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìš”ì²­ì´ ì˜¤ë©´ ì•Œë ¤ë‹¬ë¼"ëŠ” ì˜ë¯¸ë‹¤.
4.  `eventLoop()` ë©”ì†Œë“œê°€ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ë©°, `selector.select()`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œê¹Œì§€ ëŒ€ê¸°í•œë‹¤.

```java
// NioHybridServerStrategy.java
private void eventLoop() {
    while (running) {
        selector.select(); // ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œê¹Œì§€ ë¸”ë¡œí‚¹

        for (Iterator<SelectionKey> it = selector.selectedKeys().iterator(); it.hasNext();) {
            SelectionKey key = it.next();
            it.remove();

            // ... ì´ë²¤íŠ¸ ì¢…ë¥˜ì— ë”°ë¼ ì²˜ë¦¬ ë¡œì§ ë¶„ê¸° ...
        }
    }
}
```

### 2ë‹¨ê³„: ìƒˆë¡œìš´ ì—°ê²° ìˆ˜ë½ (`OP_ACCEPT`)

1.  í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì—°ê²°ì„ ì‹œë„í•˜ë©´, `Selector`ëŠ” `OP_ACCEPT` ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³  `select()` ë©”ì†Œë“œì˜ ëŒ€ê¸° ìƒíƒœë¥¼ í•´ì œí•œë‹¤.
2.  ì´ë²¤íŠ¸ ë£¨í”„ëŠ” í•´ë‹¹ `SelectionKey`ê°€ `isAcceptable()`ì¸ì§€ í™•ì¸í•˜ê³ , `ConnectionManager.acceptConnection()`ì„ í˜¸ì¶œ.
3.  `ConnectionManager`ëŠ” `serverChannel.accept()`ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì™€ì˜ `SocketChannel`ì„ ìƒì„±í•˜ê³ , ì´ ì±„ë„ ì—­ì‹œ Non-blocking ëª¨ë“œë¡œ ì„¤ì •í•¨.

### 3ë‹¨ê³„: í”„ë¡œí† ì½œ ê°ì§€ ë° í•¸ë“¤ëŸ¬ ë“±ë¡

1.  `ConnectionManager`ëŠ” ìƒì„±ëœ `SocketChannel`ì—ì„œ ì•½ê°„ì˜ ë°ì´í„°ë¥¼ ì½ì–´ `ProtocolDetector`ì—ê²Œ ì „ë‹¬í•œë‹¤. (ì´ë•Œ, ë²„í¼ë¡œ ì½ì€ ë°ì´í„°ëŠ” í•œë²ˆ ì½ìœ¼ë©´ ì†Œì‹¤ë˜ëŠ”ë°, ì¶”í›„ ì¬ì‚¬ìš©(ì‘ë‹µ íŒŒì‹±)ì„ ìœ„í•´ ë³µêµ¬í•˜ëŠ” ë¡œì§ë„ í¬í•¨ë¨)
2.  `HttpProtocolDetector`ëŠ” ì½ì–´ë“¤ì¸ ë°ì´í„°ì˜ ì‹œì‘ ë¶€ë¶„ì´ "GET ", "POST " ë“±ê³¼ ê°™ì€ HTTP ë©”ì†Œë“œ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì—¬ "HTTP/1.1" í”„ë¡œí† ì½œì„ ê°ì§€í•œë‹¤.
3.  `ConnectionManager`ëŠ” ê°ì§€ëœ í”„ë¡œí† ì½œì„ ì§€ì›í•˜ëŠ” `NioHttpProtocolHandler`ë¥¼ ì°¾ì•„ `accept()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
4.  **(í•µì‹¬)** `NioHttpProtocolHandler`ëŠ” ìš”ì²­ì„ ì§ì ‘ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹ , ì´ ì—°ê²°ì˜ ìƒíƒœë¥¼ ì „ë‹´í•˜ì—¬ ê´€ë¦¬í•  `HttpConnectionHandler` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
5.  ìƒì„±ëœ `HttpConnectionHandler`ë¥¼ `SocketChannel`ì˜ `SelectionKey`ì— **ì²¨ë¶€(attachment)**í•˜ê³ , `Selector`ì— `SelectionKey.OP_READ` ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤. ì´ëŠ” "ì´ ì±„ë„ì„ í†µí•´ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë©´ ì•Œë ¤ë‹¬ë¼"ëŠ” ì˜ë¯¸ì„.

```java
// NioHttpProtocolHandler.java
@Override
public void accept(SocketChannel channel, Selector selector, ByteBuffer initialBuffer) throws Exception {
    // 1. ìƒíƒœ ê¸°ë°˜ ì—°ê²° í•¸ë“¤ëŸ¬ ìƒì„±
    HttpConnectionHandler handler = new HttpConnectionHandler(...);

    // 2. í•¸ë“¤ëŸ¬ë¥¼ ì²¨ë¶€í•˜ì—¬ READ ì´ë²¤íŠ¸ ë“±ë¡
    channel.register(selector, SelectionKey.OP_READ, handler);

    // 3. ì´ˆê¸° ì½ê¸° íŠ¸ë¦¬ê±°
    handler.read(channel.keyFor(selector));
}
```

### 4ë‹¨ê³„: ìš”ì²­ ì½ê¸° (`OP_READ`)

1.  í´ë¼ì´ì–¸íŠ¸ê°€ HTTP ìš”ì²­ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ë©´, `Selector`ëŠ” `OP_READ` ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•œë‹¤.
2.  ì´ë²¤íŠ¸ ë£¨í”„ëŠ” `key.isReadable()`ì„ í™•ì¸í•˜ê³ , `SelectionKey`ì— ì²¨ë¶€ëœ `HttpConnectionHandler`ì˜ `read()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œ.
3.  `read()` ë©”ì†Œë“œëŠ” Non-blocking ë°©ì‹ìœ¼ë¡œ `channel.read(readBuffer)`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì†Œì¼“ ë²„í¼ì˜ ë°ì´í„°ë¥¼ `ByteBuffer`ë¡œ ì½ì–´ë“¤ì¸ë‹¤.
4.  `HttpUtils.isRequestComplete()`ë¥¼ í†µí•´ í˜„ì¬ê¹Œì§€ ì½ì€ ë°ì´í„°ê°€ ì™„ì „í•œ HTTP ìš”ì²­(í—¤ë”ì˜ ëì„ ë‚˜íƒ€ë‚´ëŠ” CRLF(CR + LF)ê³¼ `Content-Length` ë˜ëŠ” `chunked` ì¸ì½”ë”© ê¸°ë°˜ì˜ ë°”ë”” ì „ì²´)ì¸ì§€ ë°˜ë³µí•´ì„œ í™•ì¸í•œë‹¤.
5.  ìš”ì²­ì´ ì•„ì§ ë¶ˆì™„ì „í•˜ë‹¤ë©´, ë©”ì†Œë“œëŠ” ì¢…ë£Œë˜ê³  ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ë‹¤ìŒ ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦°ë‹¤. `Selector`ëŠ” ë°ì´í„°ê°€ ë” ë“¤ì–´ì˜¤ë©´ ë‹¤ì‹œ `OP_READ` ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¬ ê²ƒì´ë‹¤.

### 5ë‹¨ê³„: ìš”ì²­ ì²˜ë¦¬ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰

1.  ìš”ì²­ì´ ì™„ì „í•´ì§€ë©´, `HttpConnectionHandler`ëŠ” ìƒíƒœë¥¼ `PROCESSING`ìœ¼ë¡œ ë³€ê²½í•˜ê³  `key.interestOps(0)`ì„ í˜¸ì¶œí•˜ì—¬ ë” ì´ìƒ `Selector`ê°€ ì´ ì±„ë„ì˜ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì§€ ì•Šë„ë¡ ì„ì‹œ ì¤‘ë‹¨ì‹œí‚¨ë‹¤.
2.  **(ì¤‘ìš”)** I/O ìŠ¤ë ˆë“œ(ì´ë²¤íŠ¸ ë£¨í”„)ì˜ ë¸”ë¡œí‚¹ì„ ë§‰ê¸° ìœ„í•´, íŒŒì‹±ëœ ìš”ì²­ ë°ì´í„°(`rawRequest`)ë¥¼ `RequestExecutorService`(ë³„ë„ì˜ ì›Œì»¤ ìŠ¤ë ˆë“œ í’€)ì— íƒœìŠ¤í¬ë¡œ ì œì¶œí•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤.
3.  ì›Œì»¤ ìŠ¤ë ˆë“œëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤.
    -   `HttpRequestParser`ë¥¼ í†µí•´ ì›ì‹œ ìš”ì²­ ë¬¸ìì—´ì„ `HttpRequest` ê°ì²´ë¡œ íŒŒì‹±
    -   `RequestDispatcher`ë¥¼ í†µí•´ ìš”ì²­ì„ ì²˜ë¦¬í•  ì ì ˆí•œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì†Œë“œë¥¼ ì°¾ì•„ ì‹¤í–‰
    -   ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ `HttpResponse` ê°ì²´ì— ë‹´ê¸°

### 6ë‹¨ê³„: ì‘ë‹µ ì¤€ë¹„ ë° ì“°ê¸° ìƒíƒœ ì „í™˜

1.  ì›Œì»¤ ìŠ¤ë ˆë“œì—ì„œ `HttpResponse`ê°€ ì¤€ë¹„ë˜ë©´, `HttpUtils.createResponseBuffer()`ë¥¼ í†µí•´ ì‘ë‹µ ë°ì´í„°ë¥¼ `ByteBuffer`(`writeBuffer`)ë¡œ ë³€í™˜í•œë‹¤.
2.  `HttpConnectionHandler`ì˜ ìƒíƒœë¥¼ `WRITING`ìœ¼ë¡œ ë³€ê²½í•œë‹¤.
3.  `SelectionKey`ì˜ ê´€ì‹¬ ì´ë²¤íŠ¸ë¥¼ `SelectionKey.OP_WRITE`ë¡œ ë‹¤ì‹œ ë“±ë¡í•˜ê³ , `selector.wakeup()`ì„ í˜¸ì¶œí•˜ì—¬ `select()`ì—ì„œ ëŒ€ê¸° ì¤‘ì¸ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì¦‰ì‹œ ê¹¨ìš´ë‹¤. ì´ëŠ” ê´€ì‹¬ ì´ë²¤íŠ¸ê°€ ë³€ê²½ë˜ì—ˆìŒì„ `Selector`ì—ê²Œ ë°”ë¡œ ì•Œë¦¬ê¸° ìœ„í•¨ì´ë‹¤.

```java
// HttpConnectionHandler.java - ì›Œì»¤ ìŠ¤ë ˆë“œ ë‚´ë¶€
requestExecutorService.execute(() -> {
    try {
        // ... ìš”ì²­ íŒŒì‹± ë° ë””ìŠ¤íŒ¨ì¹˜ ...
        HttpRequest<?> req = parser.parse(rawRequest);
        HttpResponse res = new HttpResponse();
        dispatcher.dispatch(req, res);

        // 5. ì‘ë‹µ ì¤€ë¹„ ë° ìƒíƒœ ì „í™˜
        this.writeBuffer = HttpUtils.createResponseBuffer(res.getResponseEntity());
        this.currentState = HttpConnectionStatus.WRITING;

        // 6. WRITE ì´ë²¤íŠ¸ ë“±ë¡ ë° Selector ê¹¨ìš°ê¸°
        key.interestOps(SelectionKey.OP_WRITE);
        selector.wakeup();

    } catch (Exception e) {
        // ...
    }
});
```

### 7ë‹¨ê³„: ì‘ë‹µ ì“°ê¸° (`OP_WRITE`)

1.  `selector.wakeup()` í˜¸ì¶œê³¼ `OP_WRITE` ë“±ë¡ìœ¼ë¡œ ì¸í•´, `Selector`ëŠ” í•´ë‹¹ ì±„ë„ì˜ ì†Œì¼“ ë²„í¼ê°€ ì“¸ ì¤€ë¹„ê°€ ë˜ë©´ ì¦‰ì‹œ `OP_WRITE` ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
2.  ì´ë²¤íŠ¸ ë£¨í”„ëŠ” `key.isWritable()`ì„ í™•ì¸í•˜ê³ , ì²¨ë¶€ëœ `HttpConnectionHandler`ì˜ `write()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
3.  `write()` ë©”ì†Œë“œëŠ” `channel.write(writeBuffer)`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¤€ë¹„ëœ ì‘ë‹µ ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•œë‹¤.
4.  í•œ ë²ˆì˜ `write` í˜¸ì¶œë¡œ `writeBuffer`ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì „ì†¡ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤(TCP ë²„í¼ í¬ê¸° ì œí•œ ë“±). ë²„í¼ì— ë°ì´í„°ê°€ ë‚¨ì•„ìˆë‹¤ë©´(`writeBuffer.hasRemaining()`), ë©”ì†Œë“œëŠ” ì¢…ë£Œ. `Selector`ëŠ” ì†Œì¼“ ë²„í¼ê°€ ë‹¤ì‹œ ë¹„ì›Œì§€ë©´ ë˜ë‹¤ì‹œ `OP_WRITE` ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œ ë‚˜ë¨¸ì§€ ë°ì´í„°ê°€ ì „ì†¡ë˜ë„ë¡ ë³´ì¥í•˜ë„ë¡ í•œë‹¤.

### 8ë‹¨ê³„: ì—°ê²° ì¢…ë£Œ

1.  `writeBuffer`ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ë©´, `HttpConnectionHandler`ëŠ” ìƒíƒœë¥¼ `DONE`ìœ¼ë¡œ ë³€ê²½í•˜ê³  `closeConnection()`ì„ í˜¸ì¶œí•˜ì—¬ `SocketChannel`ì„ ë‹«ê³  `SelectionKey`ë¥¼ ë¬´íš¨í™”í•œë‹¤.
2.  ì´ë¡œì¨ í•˜ë‚˜ì˜ HTTP ìš”ì²­-ì‘ë‹µ ì‚¬ì´í´ì´ ì™„ë£Œë˜ì—ˆë‹¤.

## 6. í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡°ë¥¼ í†µí•œ í™•ì¥ì„± (Extensibility through Pluggable Architecture)

Sprout ì„œë²„ ì•„í‚¤í…ì²˜ì˜ ë˜ ë‹¤ë¥¸ í•µì‹¬ì ì¸ íŠ¹ì§•ì€ ë°”ë¡œ **ë†’ì€ í™•ì¥ì„±**ì´ë‹¤. ì‹¤ì œë¡œ ì´ êµ¬ì¡°ë¥¼ êµ¬ì¶•í•˜ëŠ”ë°ì— ì‹ ê²½ì„ ë§ì´ ì¼ë‹¤. ì„œë²„ì˜ ì£¼ìš” êµ¬ì„± ìš”ì†Œë“¤ì€ í•˜ë“œì½”ë”©ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©°, IoC/DI ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ëŠ” **êµì²´ ê°€ëŠ¥í•œ ë¶€í’ˆ(Bean)** ë“¤ì˜ ì¡°í•©ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

ì´ëŸ¬í•œ í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡° ë•ë¶„ì— ê°œë°œìëŠ” ìƒˆë¡œìš´ í”„ë¡œí† ì½œ, ë‹¤ë¥¸ ìŠ¤ë ˆë“œ ì‹¤í–‰ ëª¨ë¸, ë˜ëŠ” ì™„ì „íˆ ìƒˆë¡œìš´ I/O ì²˜ë¦¬ ë°©ì‹ì„ ì›í•  ë•Œ, í”„ë ˆì„ì›Œí¬ì˜ í•µì‹¬ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³ ë„ ìì‹ ë§Œì˜ êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ì–´ ì†ì‰½ê²Œ í†µí•©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

### ì„¤ì • ê¸°ë°˜ì˜ ì»´í¬ë„ŒíŠ¸ êµì²´

ì´ í™•ì¥ì„±ì€ `@Configuration` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•œ ì„¤ì • í´ë˜ìŠ¤ì™€ `application.yml` íŒŒì¼ì„ í†µí•´ ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `ServerConfiguration` í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„œë²„ì˜ í•µì‹¬ ë™ì‘ì„ ê²°ì •í•˜ëŠ” Beanë“¤ì„ ì •ì˜í•œë‹¤.

```java
// ServerConfiguration.java
@Configuration
public class ServerConfiguration {

    @Bean
    public RequestExecutorService executorService(AppConfig appConfig, List<ContextPropagator> contextPropagators) {
        // "server.thread-type" í”„ë¡œí¼í‹° ê°’ì— ë”°ë¼ ìŠ¤ë ˆë“œ ì‹¤í–‰ ëª¨ë“œë¥¼ ê²°ì •
        String threadType = appConfig.getStringProperty("server.thread-type", "virtual");
        if (threadType.equals("virtual")) {
            return new VirtualRequestExecutorService(contextPropagators);
        }
        return new RequestExecutorPoolService(appConfig.getIntProperty("server.thread-pool-size", 100));
    }

    @Bean
    public AcceptableProtocolHandler httpProtocolHandler(AppConfig appConfig, /*...dependencies...*/) {
        // "server.execution-mode" í”„ë¡œí¼í‹° ê°’ì— ë”°ë¼ I/O ì²˜ë¦¬ í•¸ë“¤ëŸ¬ë¥¼ ê²°ì •
        String executionMode = appConfig.getStringProperty("server.execution-mode", "hybrid");
        if (executionMode.equals("hybrid")) {
            return new BioHttpProtocolHandler(...);
        }
        return new NioHttpProtocolHandler(...);
    }
}
```

ê°œë°œìëŠ” `application.yml` íŒŒì¼ì˜ í”„ë¡œí¼í‹° ê°’ì„ ë³€ê²½í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ì„œë²„ì˜ ë™ì‘ ë°©ì‹ì„ ê·¼ë³¸ì ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆê²Œ ëœë‹¤.

```yaml
# application.yml
server:
  execution-mode: nio       # nio ë˜ëŠ” hybrid
  thread-type: virtual    # virtual ë˜ëŠ” platform
```

- `execution-mode`ë¥¼ `nio`ë¡œ ë°”ê¾¸ë©´ `NioHttpProtocolHandler`ê°€ ì£¼ì…
- `thread-type`ì„ `platform`ìœ¼ë¡œ ë°”ê¾¸ë©´ `RequestExecutorPoolService`ê°€ ì£¼ì…

### ê°œë°œìì— ì˜í•œ ì»¤ìŠ¤í…€ êµ¬í˜„ì²´ í†µí•©

ì´ êµ¬ì¡°ì˜ ì§„ì •í•œ ê°•ì ì€ ê°œë°œìê°€ ìì‹ ë§Œì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ ì‹œìŠ¤í…œì— ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.(ê·¸ë˜ì„œ í•™ìŠµìš©ìœ¼ë¡œ ì¢‹ì„ë“¯?)

ì˜ˆë¥¼ ë“¤ì–´, ê°œë°œìê°€ `MyCustomProtocolHandler`ë¼ëŠ” ìƒˆë¡œìš´ í”„ë¡œí† ì½œ í•¸ë“¤ëŸ¬ë¥¼ ë§Œë“¤ì—ˆë‹¤ê³  ê°€ì •í•´ ë³´ì. ì´ í•¸ë“¤ëŸ¬ë¥¼ ì‹œìŠ¤í…œì— í†µí•©í•˜ëŠ” ë°©ë²•ì€ ë§¤ìš° ê°„ë‹¨í•˜ë‹¤.

1.  `AcceptableProtocolHandler` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” `MyCustomProtocolHandler` í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•œë‹¤.
2.  `@Configuration` í´ë˜ìŠ¤ì— ìƒˆë¡œìš´ `@Bean` ë©”ì†Œë“œë¥¼ ì¶”ê°€í•˜ì—¬ ì˜µì…˜ë³„ë¡œ ë¶„ê¸°ì‹œí‚¤ê±°ë‚˜, í•˜ë‚˜ë§Œ ì‚¬ìš©í•œë‹¤ë©´ `@Component`ë¥¼ ë‹¬ë©´ ëœë‹¤. 

```java
// ì˜ˆì‹œ: ê¸°ì¡´ httpProtocolHandler ë©”ì†Œë“œ ìˆ˜ì •
@Bean
public AcceptableProtocolHandler httpProtocolHandler(AppConfig appConfig, ...) {
    String executionMode = appConfig.getStringProperty("server.execution-mode", "hybrid");
    if (executionMode.equals("hybrid")) {
        return new BioHttpProtocolHandler(...);
    } else if (executionMode.equals("my-custom-mode")) {
        // ê°œë°œìê°€ ë§Œë“  ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬ ì£¼ì…
        return new MyCustomProtocolHandler(...);
    }
    return new NioHttpProtocolHandler(...);
}
```

ë˜í•œ, Sproutì˜ DI ì»¨í…Œì´ë„ˆëŠ” íŠ¹ì • íƒ€ì…ì˜ ëª¨ë“  Beanì„ `List`ë¡œ ì£¼ì…í•˜ëŠ” ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤. `ConnectionManager`ëŠ” `List<ProtocolDetector>`ì™€ `List<ProtocolHandler>`ë¥¼ ì£¼ì…ë°›ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ê°œë°œìê°€ ìƒˆë¡œìš´ í”„ë¡œí† ì½œ íƒì§€ê¸°ë‚˜ í•¸ë“¤ëŸ¬ë¥¼ ë‹¨ìˆœíˆ Beanìœ¼ë¡œ ë“±ë¡í•˜ê¸°ë§Œ í•˜ë©´ `ConnectionManager`ê°€ ì´ë¥¼ ìë™ìœ¼ë¡œ ì¸ì‹í•˜ê³  ìì‹ ì˜ ë¡œì§ì— í¬í•¨ì‹œí‚¨ë‹¤.

ì´ì²˜ëŸ¼ ì„œë²„ëŠ” í•µì‹¬ ê¸°ëŠ¥ë“¤ì´ ëª¨ë“ˆí™”ë˜ì–´ ìˆê³  DIë¥¼ í†µí•´ ìœ ì—°í•˜ê²Œ ì¡°ë¦½ë˜ëŠ” êµ¬ì¡°ë¥¼ ê°€ì§ìœ¼ë¡œì¨, ë³€í™”í•˜ëŠ” ìš”êµ¬ì‚¬í•­ê³¼ ìƒˆë¡œìš´ ê¸°ìˆ ì— ì‰½ê²Œ ì ì‘í•  ìˆ˜ ìˆëŠ” ë†’ì€ ìˆ˜ì¤€ì˜ í™•ì¥ì„±ì„ ì œê³µí•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

ì‚¬ì‹¤ ê·¸ëƒ¥ ì´ ë¶€ë¶„ì€ ìŠ¤í”„ë§ ì²´ê³„ë¥¼ ê·¸ëŒ€ë¡œ ëª¨ë°©í•´ì˜¨ ê²ƒì´ë¼ ë‹¹ì—°í•˜ë‹¤.

## 7. ì•„í‚¤í…ì²˜ ë¹„êµ: Sprout vs. Tomcat vs. Netty

Sprout ì„œë²„ì˜ ì•„í‚¤í…ì²˜ëŠ” ê¸°ì¡´ì˜ ìœ ëª…í•œ ì„œë²„ êµ¬í˜„ì²´ì¸ í†°ìº£(Tomcat)ê³¼ ë„¤í‹°(Netty)ì˜ íŠ¹ì§•ì„ ëª¨ë‘ ì¼ë¶€ ê°€ì§€ê³  ìˆì§€ë§Œ, í•œìª½ì— ë” ê°•í•˜ê²Œ ê¸°ìš¸ì–´ ìˆë‹¤. ê° í”„ë ˆì„ì›Œí¬ì™€ì˜ ë¹„êµë¥¼ í†µí•´ Sproutì˜ ì•„í‚¤í…ì²˜ì  ìœ„ì¹˜ë¥¼ ë” ëª…í™•íˆ ì´í•´í•  ìˆ˜ ìˆë‹¤.

### í†°ìº£(Tomcat)ê³¼ì˜ ë¹„êµ

í†°ìº£ì€ ìë°” ì„œë¸”ë¦¿(Servlet) ì»¨í…Œì´ë„ˆì˜ í‘œì¤€ êµ¬í˜„ì²´ë¡œ, Sproutì™€ëŠ” 'ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„'ë¼ëŠ” ëª©í‘œë¥¼ ê³µìœ í•˜ì§€ë§Œ ë‚´ë¶€ ë™ì‘ ì›ë¦¬ì™€ ì¶”ìƒí™” ìˆ˜ì¤€ì—ì„œ í° ì°¨ì´ë¥¼ ë³´ì¸ë‹¤.

#### ìœ ì‚¬ì 
- **í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œì˜ ê°œë…**: Sproutì˜ 'í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ'ëŠ” í†°ìº£ì˜ ìµœì‹  ì»¤ë„¥í„°(Coyote)ê°€ ë™ì‘í•˜ëŠ” ë°©ì‹ê³¼ ê°œë…ì ìœ¼ë¡œ ìœ ì‚¬í•˜ë‹¤. ì¦‰, ì†Œìˆ˜ì˜ I/O ìŠ¤ë ˆë“œ(Selector ì‚¬ìš©)ê°€ ë…¼ë¸”ë¡œí‚¹ìœ¼ë¡œ ì—°ê²°ì„ ìˆ˜ë½í•˜ê³ , ì‹¤ì œ ìš”ì²­ ì²˜ë¦¬ëŠ” ë‹¤ìˆ˜ì˜ ì›Œì»¤ ìŠ¤ë ˆë“œ í’€ì— ìœ„ì„í•˜ì—¬ ë¸”ë¡œí‚¹ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ëª¨ë¸ì¸ ê²ƒì´ë‹¤.

#### ì°¨ì´ì 
- **í•µì‹¬ ì¶”ìƒí™”**: í†°ìº£ì˜ í•µì‹¬ ì¶”ìƒí™”ëŠ” **ì„œë¸”ë¦¿ API**ì´ë‹¤. ê°œë°œìëŠ” `HttpServlet`ì„ ìƒì†í•˜ê³  `doGet`, `doPost` ë©”ì†Œë“œë¥¼ êµ¬í˜„í•˜ë©°, ë„¤íŠ¸ì›Œí¬ì˜ ì €ìˆ˜ì¤€ ë™ì‘(NIO, ì´ë²¤íŠ¸ ë£¨í”„ ë“±)ì€ í†°ìº£ì´ ì™„ì „íˆ ê°ì¶˜ë‹¤. ë°˜ë©´, SproutëŠ” `ProtocolHandler`ë‚˜ `HttpConnectionHandler` ê°™ì´ ë„¤íŠ¸ì›Œí¬ ì´ë²¤íŠ¸ì— ë” ê°€ê¹Œìš´, **ë” ë‚®ì€ ìˆ˜ì¤€ì˜ ì¶”ìƒí™”**ë¥¼ ì œê³µí•œë‹¤.
- **í”„ë¡œê·¸ë˜ë° ëª¨ë¸**: í†°ìº£ì€ ê°œë°œìì—ê²Œ **ë™ê¸°/ë¸”ë¡œí‚¹** í”„ë¡œê·¸ë˜ë° ëª¨ë¸ì„ ì œê³µí•œë‹¤. Sproutì˜ Pure NIO ëª¨ë“œëŠ” **ë¹„ë™ê¸°/ì´ë²¤íŠ¸ ê¸°ë°˜** í”„ë¡œê·¸ë˜ë° ëª¨ë¸ì„ ì±„íƒí•˜ê³  ìˆì–´, ì´ ë¶€ë¶„ì—ì„œ ê·¼ë³¸ì ì¸ ì°¨ì´ê°€ ìˆë‹¤.

Sproutì˜ â€œHybrid + Platform Threadâ€ ëª¨ë¸ì€ í†°ìº£ì˜ NIO ì»¤ë„¥í„°(http-nio)ì™€ êµ¬ì¡°ì ìœ¼ë¡œ ê±°ì˜ ë™ì¼í•œ íŒ¨í„´ì´ë‹¤. ìŠ¤í”„ë§ì„ êµ¬ë™í•˜ë©´ `[nio] `ë˜ëŠ” `"http-nio-8080"` ë¡œê·¸ë¥¼ ë³¼ ìˆ˜ ìˆëŠ”ë° ì´ëŠ” í†°ìº£ì´ ë‚´ë¶€ì ìœ¼ë¡œ `org.apache.coyote.http11.Http11NioProtocol` ë¥¼ ì„ íƒí–ˆë‹¤ëŠ” ëœ»ì´ê³ , ì´ê²Œ ê¸°ë³¸ ê°’ì´ë‹¤. í•´ë‹¹ êµ¬í˜„ì²´ë„ ì‹¤ì œë¡œ Selectorë¡œ ìš”ì²­ì„ ë°›ê³  ë‚´ë¶€ì ìœ¼ë¡œ ì›Œì»¤ ìŠ¤ë ˆë“œì— í• ë‹¹í•´ì£¼ëŠ” íŒ¨í„´ì´ë‹¤.

### ë„¤í‹°(Netty)ì™€ì˜ ë¹„êµ

NettyëŠ” ê³ ì„±ëŠ¥ ë„¤íŠ¸ì›Œí¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ê¸° ìœ„í•œ ë¹„ë™ê¸° ì´ë²¤íŠ¸ ê¸°ë°˜ í”„ë ˆì„ì›Œí¬ë¡œ, Sprout ì•„í‚¤í…ì²˜ëŠ” Nettyì™€ ë§¤ìš° ê°•ë ¥í•œ ìœ ì‚¬ì„±ì´ ìˆë‹¤.

#### ìœ ì‚¬ì 
- **í•µì‹¬ ì•„í‚¤í…ì²˜**: Sproutì˜ Pure NIO ëª¨ë“œëŠ” Nettyì˜ í•µì‹¬ ì•„í‚¤í…ì²˜ë¥¼ ê±°ì˜ ê·¸ëŒ€ë¡œ ë°˜ì˜í•œë‹¤. **ì´ë²¤íŠ¸ ë£¨í”„(`EventLoop`)**, **`Selector`**, **ë…¼ë¸”ë¡œí‚¹ ì±„ë„(`Channel`)**, ê·¸ë¦¬ê³  **í•¸ë“¤ëŸ¬ íŒŒì´í”„ë¼ì¸(`Pipeline`)** ê°œë…ì€ ë‘ í”„ë ˆì„ì›Œí¬ì˜ ì‹¬ì¥ì„ ì´ë£¨ëŠ” ë™ì¼í•œ ì„¤ê³„ ì‚¬ìƒì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.
- **í”„ë¡œê·¸ë˜ë° ëª¨ë¸**: Sproutì˜ `HttpConnectionHandler`ê°€ `READING` -> `PROCESSING` -> `WRITING` ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©° ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì€ Nettyì˜ `ChannelHandler`ê°€ I/O ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ê³¼ êµ‰ì¥íˆ ìœ ì‚¬í•˜ê¸´ í•˜ë‹¤.
- **ì €ìˆ˜ì¤€ ì œì–´**: `ByteBuffer`ë¥¼ ì§ì ‘ ë‹¤ë£¨ê³ , í”„ë¡œí† ì½œì„ íŒŒì‹±í•˜ë©°, ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œë¥¼ ì²´í¬í•˜ëŠ” ë“± ì €ìˆ˜ì¤€ì˜ ë„¤íŠ¸ì›Œí¬ ì œì–´ê¶Œì„ ê°œë°œìì—ê²Œ ì œê³µí•œë‹¤ëŠ” ì ì—ì„œ ë¹„ìŠ·í•˜ê¸°ë„ í•˜ë‹¤.

#### ì°¨ì´ì 
- **ë²”ìœ„ì™€ ëª©ì **: NettyëŠ” HTTP, TCP, UDP ë“± ë‹¤ì–‘í•œ í”„ë¡œí† ì½œì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” **ë²”ìš© ë„¤íŠ¸ì›Œí¬ í”„ë ˆì„ì›Œí¬**ì´ë‹¤. ë°˜ë©´, Sproutì€ Nettyì˜ ì•„í‚¤í…ì²˜ë¥¼ ì°¨ìš©í•˜ì—¬ **ì›¹ ì„œë²„ ë° MVC í”„ë ˆì„ì›Œí¬ë¼ëŠ” íŠ¹ì • ëª©ì **ì— ë§ê²Œ íŠ¹í™”ì‹œí‚¨ êµ¬í˜„ì²´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.
- **ì™„ì„±ë„ì™€ ê¸°ëŠ¥**: NettyëŠ” ìˆ˜ë§ì€ í”„ë¡œí† ì½œ ì½”ë±, ìŠ¤ë ˆë”© ëª¨ë¸, ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ë²• ë“± ë°©ëŒ€í•˜ê³  ê³ ë„ë¡œ ìµœì í™”ëœ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì•„ì£¼ ì„±ìˆ™í•œ í”„ë ˆì„ì›Œí¬ì´ë‹¤. Sproutì€ í•´ë‹¹ ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ê°œë…ì„ ì¼ë¶€ ì°¨ìš©í•œ ê²ƒ ë¿ì´ë‹¤.

| í•­ëª©                    | **Sprout**                                            | **Tomcat**                         | **Netty**                             |
| --------------------- | ----------------------------------------------------- | ---------------------------------- | ------------------------------------- |
| **ì£¼ ìš©ë„**              | í•™ìŠµìš© ê²½ëŸ‰ ì›¹ ì„œë²„ / í”„ë ˆì„ì›Œí¬                                   | í‘œì¤€ Java ì›¹ ì•± ì„œë²„ (Servlet ê¸°ë°˜)        | ë²”ìš© ë¹„ë™ê¸° ë„¤íŠ¸ì›Œí¬ í”„ë ˆì„ì›Œí¬                     |
| **í•µì‹¬ ì•„í‚¤í…ì²˜**           | Selector ê¸°ë°˜ ì´ë²¤íŠ¸ ë£¨í”„ + Hybrid ì²˜ë¦¬ ëª¨ë¸ (BIO+NIO)           | Coyote ì»¤ë„¥í„° + ì›Œì»¤ìŠ¤ë ˆë“œ í’€ + Servlet API | EventLoopGroup + ChannelPipeline      |
| **I/O ëª¨ë¸**            | Hybrid (NIO+BIO) / Pure NIO ì§€ì›                        | Hybrid (NIO+BIO)                   | Pure NIO (ì´ë²¤íŠ¸ ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬)              |
| **í”„ë¡œê·¸ë˜ë° ëª¨ë¸**          | ë¹„ë™ê¸° ìƒíƒœ ë¨¸ì‹  or ë™ê¸° ë¸”ë¡œí‚¹ (ì„ íƒ ê°€ëŠ¥)                           | ë™ê¸°/ë¸”ë¡œí‚¹ ìœ„ì£¼ (Servlet ê¸°ë°˜)             | ì™„ì „í•œ ë¹„ë™ê¸°/ì´ë²¤íŠ¸ ê¸°ë°˜                        |
| **í™•ì¥ì„±**               | í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜ ê¸°ë°˜, DIë¡œ ìœ ì—°ì„± í™•ë³´                              | ì •í˜•í™”ëœ Servlet ì»¨í…Œì´ë„ˆ êµ¬ì¡°               | ì½”ì–´ ìì²´ê°€ í™•ì¥ ê°€ëŠ¥, ìœ ì—°ì„± ìµœê³                   |
| **ìŠ¤ë ˆë“œ ëª¨ë¸**            | Virtual Threads / Platform Threads ì„ íƒ ê°€ëŠ¥              | í”Œë«í¼ ìŠ¤ë ˆë“œ ê¸°ë°˜ ì›Œì»¤í’€                     | ì»¤ìŠ¤í…€ ê°€ëŠ¥ (ìŠ¤ë ˆë“œ ê·¸ë£¹ ì§€ì •)                    |


## 8. ê²°ë¡ 

ê²°ë¡ ì ìœ¼ë¡œ, Sprout ì„œë²„ëŠ” **'Nettyì˜ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²½ëŸ‰ ì›¹ í”„ë ˆì„ì›Œí¬'** ë¼ê³  ì •ì˜í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. í†°ìº£ì²˜ëŸ¼ ìµœì¢… ì‚¬ìš©ì(ì›¹ ê°œë°œì)ë¥¼ ìœ„í•œ í¸ì˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©´ì„œë„, ë‚´ë¶€ì ìœ¼ë¡œëŠ” Nettyì™€ ê°™ì€ ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬ ì—”ì§„ì„ ë³´ìœ í•˜ëŠ” í˜•íƒœë‹¤.

## 9. í˜„ì¬ì˜ í•œê³„ ë° ê°œì„  ë°©í–¥

ì§€ê¸ˆê¹Œì§€ ì§ì ‘ ë§Œë“  í”„ë ˆì„ì›Œí¬ê°€ ê°€ì§„ ì•„í‚¤í…ì²˜ì˜ íŠ¹ì§•ê³¼ ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì„œìˆ í–ˆì§€ë§Œ, í˜„ì¬ ë²„ì „ì€ í•™ìŠµê³¼ ì‹¤í—˜ì˜ ì‚°ë¬¼ë¡œì„œ ìƒìš© í”„ë ˆì„ì›Œí¬ì— ë¹„í•˜ë©´ ì•„ì§ ë¶€ì¡±í•œ ì ì´ ë§ë‹¤(ì‚¬ì‹¤ ë‹¹ì—°í•˜ë‹¤). ì•ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ê°œì„  ê³¼ì œë“¤ì„ ê³ ë¯¼í•´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

- **HTTP/2 ë° HTTP/3 ì§€ì›**: í˜„ì¬ êµ¬í˜„ì€ HTTP/1.1ì„ ì¤‘ì‹¬ìœ¼ë¡œ í•˜ê³  ìˆë‹¤. ë” ë‚˜ì€ ì„±ëŠ¥ê³¼ íš¨ìœ¨ì„ ìœ„í•´ ìµœì‹  í”„ë¡œí† ì½œì¸ HTTP/2ì˜ ìŠ¤íŠ¸ë¦¼ ë©€í‹°í”Œë ‰ì‹±ì´ë‚˜ HTTP/3ì˜ QUIC í”„ë¡œí† ì½œì„ ì§€ì›í•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•œ ì¥ê¸° ëª©í‘œê°€ ë  ìˆ˜ ìˆë‹¤.

- **ê³ ê¸‰ ì„±ëŠ¥ ìµœì í™”**: Nettyì™€ ê°™ì€ ì„±ìˆ™í•œ í”„ë ˆì„ì›Œí¬ëŠ” `ByteBuf`ì˜ í’€ë§(Pooling)ì„ í†µí•´ GC(Garbage Collection) ë¶€ë‹´ì„ ìµœì†Œí™”í•˜ê³ , ê°ì²´ ì¬ì‚¬ìš© ë“± ë‹¤ì–‘í•œ ê¸°ë²•ìœ¼ë¡œ ì„±ëŠ¥ì„ ê·¹í•œê¹Œì§€ ëŒì–´ì˜¬ë¦°ë‹¤. Sprout ì—­ì‹œ ë©”ëª¨ë¦¬ í• ë‹¹ì„ ì¤„ì´ê³  CPU ì‚¬ìš©ì„ ìµœì í™”í•˜ê¸° ìœ„í•œ ë” ê¹Šì´ ìˆëŠ” ìµœì í™” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

- **ì•ˆì •ì„± ë° ì˜ˆì™¸ ì²˜ë¦¬ ê³ ë„í™”**: í˜„ì¬ì˜ ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ ë” ì •êµí•˜ê²Œ ë‹¤ë“¬ì–´, íŠ¹ì • ì—°ê²°ì—ì„œ ë°œìƒí•œ ì–˜ê¸°ì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ì „ì²´ ì´ë²¤íŠ¸ ë£¨í”„ë‚˜ ì„œë²„ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šë„ë¡ ê²©ë¦¬í•˜ê³ , ë” ì•ˆì •ì ì¸ 'ìš°ì•„í•œ ì¢…ë£Œ(Graceful Shutdown)'ë¥¼ êµ¬í˜„í•˜ì—¬ ì§„í–‰ ì¤‘ì´ë˜ ìš”ì²­ì„ ì•ˆì „í•˜ê²Œ ë§ˆë¬´ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì˜ ë³´ê°•ì´ í•„ìš”í•˜ë‹¤.

- **ë³´ì•ˆ ê°•í™”**: ì›¹ ì„œë²„ë¡œì„œ ê°–ì¶°ì•¼ í•  ê¸°ë³¸ì ì¸ ë³´ì•ˆ ê¸°ëŠ¥(ì˜ˆ: íŠ¹ì • HTTP í—¤ë” ì²˜ë¦¬, ê²½ë¡œ ì¡°ì‘ ë°©ì§€, ìš”ì²­ í¬ê¸° ì œí•œ ë“±)ì„ ê°•í™”í•˜ê³ , ì•Œë ¤ì§„ ì›¹ ì·¨ì•½ì ì— ëŒ€í•œ ë°©ì–´ ë¡œì§ì„ ì§€ì†ì ìœ¼ë¡œ ì¶”ê°€í•´ì•¼ í•œë‹¤.

ì´ëŸ¬í•œ ê³¼ì œë“¤ì„ í•´ê²°í•´ ë‚˜ê°€ëŠ” ê³¼ì •ì€ ë„¤íŠ¸ì›Œí¬ì™€ ì„œë²„ ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ë” ê¹Šì€ ì´í•´ë¡œ ì´ëŒì–´ ì¤„ ê²ƒì´ë¼ ìƒê°í•œë‹¤.

---

ì´ë¡œì¨ ì„œë²„ ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ì „ë°˜ì ì¸ ì„¤ëª…ì´ ëë‚¬ë‹¤. ì´ëŠ” HTTP ì¤‘ì‹¬ì´ê³ , ì¶”í›„ì— ë‹¤ë¥¸ í”„ë¡œí† ì½œ(Websocket) ì²˜ë¦¬ êµ¬í˜„ì— ëŒ€í•´ì„œ, í˜¹ì€ HTTPì˜ êµ¬ì²´ì ì¸ íŒŒì‹±ì— ëŒ€í•´ì„œë„ ì´ì•¼ê¸°í•´ ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

ì§€ë‚œ ë²ˆì— í•´ë‹¹ [ì„œë²„ì˜ ì—¬ëŸ¬ ëª¨ë“œì˜ ì•ˆì •ì„± ë° ì„±ëŠ¥ í…ŒìŠ¤íŠ¸](https://velog.io/@cassidy/Sprout-5.-%EC%9E%90%EC%B2%B4-%EC%A0%9C%EC%9E%91-%EC%84%9C%EB%B2%84-%EC%84%B1%EB%8A%A5-%EB%B0%8F-%EC%95%88%EC%A0%95%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8)ë¥¼ ì§„í–‰í•œ ë°” ìˆëŠ”ë°, ì´ì— ëŒ€í•œ êµ¬ì²´ì ì¸ í•´ê²°ë²•ê³¼ ë‹¤ë¥¸ í™•ì¥ ë°©ë²• ë° í¬ì¸íŠ¸ì— ëŒ€í•´ì„œ ìƒê°í•´ë‘” ê²ƒë“¤ì´ ìˆì–´ì„œ ì´ë¥¼ ë¨¼ì € í’€ì–´ë³´ê³ ì í•œë‹¤.

ì‹¤ì œ êµ¬ë™ ëª¨ìŠµì€ [ì´ í¬ìŠ¤íŠ¸](https://velog.io/@cassidy/Sprout-5.-%EC%9E%90%EC%B2%B4-%EC%A0%9C%EC%9E%91-%EC%84%9C%EB%B2%84-%EC%84%B1%EB%8A%A5-%EB%B0%8F-%EC%95%88%EC%A0%95%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8)ë¡œ ì´ë™í•˜ì…”ì„œ ë²¤ì¹˜ë§ˆí‚¹ í…ŒìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ì„¸ìš”. ì˜ìƒë„ ìˆìŒ.

> https://github.com/yyubin/sprout

